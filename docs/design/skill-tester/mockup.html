<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Skill — Skill Builder</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&family=IBM+Plex+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body, #root { height: 100%; }
    body { background: #0a0a0a; }
    ::-webkit-scrollbar { width: 5px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #252525; border-radius: 3px; }
    textarea { outline: none; }
    .run-btn:hover { background: #2563eb !important; }
    .run-btn:active { transform: scale(0.98); }
    @keyframes fadeIn { from { opacity:0; transform:translateY(2px); } to { opacity:1; transform:translateY(0); } }
    .fade-in { animation: fadeIn 0.2s ease forwards; }
  </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">

const mono = "'JetBrains Mono', monospace";
const sans = "'IBM Plex Sans', -apple-system, sans-serif";

// Plan mode output — WITH skill
const WITH_PLAN = [
  { t: "summary", s: "I'll implement data quality checks and late-arrival handling for your silver layer customer table in dbt on Microsoft Fabric." },
  { t: "heading", s: "Plan" },
  { t: "step", n: "1", s: "Add not_null + unique tests on customer_id and a source freshness check (warn 6h / error 24h) in schema.yml — catches Fabric pipeline lag before DQ runs." },
  { t: "step", n: "2", s: "Add accepted_values on customer_status matching Salesforce picklist values exactly — prevents silent enum drift from corrupting downstream churn metrics." },
  { t: "step", n: "3", s: "Reconfigure customer.sql as incremental with merge strategy, unique_key=customer_id, and a 3-day lookback window on updated_at to absorb CDC lag from the Fabric connector." },
  { t: "step", n: "4", s: "Create customer_recon.sql as a weekly full-refresh model scanning all of raw_customers — handles late arrivals beyond the 3-day window." },
  { t: "heading", s: "Files" },
  { t: "file", icon: "✎", label: "models/silver/customer.sql", note: "add incremental config + lookback" },
  { t: "file", icon: "✎", label: "models/silver/schema.yml", note: "add DQ tests + source freshness" },
  { t: "file", icon: "+", label: "models/reconciliation/customer_recon.sql", note: "create weekly full-refresh" },
];

// Plan mode output — WITHOUT skill
const WITHOUT_PLAN = [
  { t: "summary", s: "I'll help you add data quality checks to your dbt model and set up incremental loading for late-arriving records." },
  { t: "heading", s: "Plan" },
  { t: "step", n: "1", s: "Add not_null and unique tests on customer_id in schema.yml." },
  { t: "step", n: "2", s: "Add accepted_values test on the status column for common values like active and inactive." },
  { t: "step", n: "3", s: "Configure the model as incremental using updated_at as the watermark column." },
  { t: "heading", s: "Files" },
  { t: "file", icon: "✎", label: "models/silver/customer.sql", note: "add incremental config" },
  { t: "file", icon: "✎", label: "models/silver/schema.yml", note: "add basic DQ tests" },
];

// Evaluator — single-sentence bullets
const EVAL_BULLETS = [
  { type: "pos", text: "Skill adds Fabric-specific context — lookback window and CDC lag handling are absent from the baseline plan." },
  { type: "pos", text: "Step count meaningfully higher with skill (4 vs 3) — the reconciliation model for late arrivals beyond 3 days is a production-relevant addition." },
  { type: "pos", text: "Enum guard is Salesforce-aware with the skill; baseline uses generic values ('active', 'inactive') that will likely miss real picklist values." },
  { type: "pos", text: "Source freshness check is only present in the skill plan — important for catching Fabric pipeline lag before DQ tests run." },
  { type: "gap", text: "Neither plan addresses SCD Type 2 — a customer table at silver layer often needs effective_date / expiry_date, which would change the model design entirely." },
  { type: "gap", text: "Test severity levels (warn vs error) absent from both plans — in production, not every DQ failure should halt a run." },
];

function PlanPanel({ lines }) {
  return (
    <div style={{ flex: 1, overflow: 'auto', padding: '14px 16px' }}>
      {lines.map((line, i) => {
        if (line.t === 'summary') return (
          <p key={i} style={{ fontFamily: mono, fontSize: '11.5px', lineHeight: '1.75', color: '#888', marginBottom: '14px' }}>
            {line.s}
          </p>
        );
        if (line.t === 'heading') return (
          <div key={i} style={{ fontSize: '10px', textTransform: 'uppercase', letterSpacing: '0.09em', color: '#3a6a8a', fontWeight: 600, marginTop: i > 0 ? '14px' : 0, marginBottom: '8px', fontFamily: sans }}>
            {line.s}
          </div>
        );
        if (line.t === 'step') return (
          <div key={i} style={{ display: 'flex', gap: '9px', marginBottom: '7px', alignItems: 'flex-start' }}>
            <span style={{ fontFamily: mono, fontSize: '10px', color: '#2563eb', fontWeight: 600, marginTop: '2px', flexShrink: 0, width: '14px' }}>{line.n}</span>
            <p style={{ fontFamily: mono, fontSize: '11.5px', lineHeight: '1.7', color: '#a8a8a8', margin: 0 }}>{line.s}</p>
          </div>
        );
        if (line.t === 'file') return (
          <div key={i} style={{ display: 'flex', gap: '8px', alignItems: 'center', marginBottom: '5px', padding: '5px 8px', background: '#0d0d0d', borderRadius: '4px', border: '1px solid #181818' }}>
            <span style={{ fontFamily: mono, fontSize: '10px', color: line.icon === '+' ? '#4ade80' : '#fb923c', flexShrink: 0 }}>{line.icon}</span>
            <span style={{ fontFamily: mono, fontSize: '11px', color: '#c0c0c0', flex: 1 }}>{line.label}</span>
            <span style={{ fontFamily: mono, fontSize: '10px', color: '#383838' }}>{line.note}</span>
          </div>
        );
        return null;
      })}
    </div>
  );
}

function App() {
  const [hSplit, setHSplit] = React.useState(60);
  const [vSplit, setVSplit] = React.useState(50);
  const hDragging = React.useRef(false);
  const vDragging = React.useRef(false);
  const containerRef = React.useRef(null);
  const topRef = React.useRef(null);

  React.useEffect(() => {
    const onMove = (e) => {
      if (hDragging.current && containerRef.current) {
        const rect = containerRef.current.getBoundingClientRect();
        const pct = ((e.clientY - rect.top) / rect.height) * 100;
        setHSplit(Math.min(82, Math.max(28, pct)));
      }
      if (vDragging.current && topRef.current) {
        const rect = topRef.current.getBoundingClientRect();
        const pct = ((e.clientX - rect.left) / rect.width) * 100;
        setVSplit(Math.min(78, Math.max(22, pct)));
      }
    };
    const onUp = () => { hDragging.current = false; vDragging.current = false; };
    window.addEventListener('mousemove', onMove);
    window.addEventListener('mouseup', onUp);
    return () => { window.removeEventListener('mousemove', onMove); window.removeEventListener('mouseup', onUp); };
  }, []);

  const border = '1px solid #161616';
  const labelStyle = { fontSize: '10.5px', textTransform: 'uppercase', letterSpacing: '0.09em', color: '#383838', fontWeight: 600, fontFamily: sans };

  return (
    <div style={{ height: '100vh', display: 'flex', flexDirection: 'column', background: '#0a0a0a', color: '#e0e0e0', fontFamily: sans }}>

      {/* Title bar */}
      <div style={{ height: '38px', background: '#070707', borderBottom: border, display: 'flex', alignItems: 'center', justifyContent: 'center', flexShrink: 0, position: 'relative' }}>
        <div style={{ position: 'absolute', left: '14px', display: 'flex', gap: '7px' }}>
          {['#ff5f57','#febc2e','#28c840'].map((c, i) => (
            <div key={i} style={{ width: '12px', height: '12px', borderRadius: '50%', background: c, opacity: 0.4 }} />
          ))}
        </div>
        <span style={{ color: '#2a2a2a', fontSize: '11.5px', letterSpacing: '0.04em', fontWeight: 500 }}>Skill Builder</span>
      </div>

      {/* Page header */}
      <div style={{ height: '42px', borderBottom: border, display: 'flex', alignItems: 'center', padding: '0 16px', flexShrink: 0, background: '#090909' }}>
        <span style={{ ...labelStyle, color: '#303030', letterSpacing: '0.1em' }}>Test Skill</span>
        <div style={{ flex: 1 }} />
        {/* Plan mode badge */}
        <div style={{ display: 'flex', alignItems: 'center', gap: '6px', marginRight: '10px', background: '#0f1a0f', border: '1px solid #1a2e1a', borderRadius: '5px', padding: '4px 10px' }}>
          <span style={{ fontSize: '10px', color: '#4ade80', letterSpacing: '0.05em', fontWeight: 500 }}>PLAN MODE</span>
        </div>
        {/* Skill picker */}
        <div style={{ display: 'flex', alignItems: 'center', gap: '7px', background: '#111', border: '1px solid #1e1e1e', borderRadius: '6px', padding: '5px 11px', cursor: 'pointer' }}>
          <div style={{ width: '7px', height: '7px', borderRadius: '50%', background: '#16a34a' }} />
          <span style={{ color: '#c8c8c8', fontSize: '12.5px' }}>dbt-fabric-skill</span>
          <span style={{ color: '#383838', fontSize: '10px', marginLeft: '2px' }}>▾</span>
        </div>
      </div>

      {/* Prompt */}
      <div style={{ padding: '11px 16px', borderBottom: border, display: 'flex', gap: '10px', alignItems: 'flex-start', flexShrink: 0, background: '#090909' }}>
        <textarea
          rows={3}
          defaultValue="I'm building a silver layer customer table in dbt on Microsoft Fabric. What data quality checks should I implement and how should I handle late-arriving records?"
          style={{ flex: 1, background: '#0d0d0d', border: '1px solid #1c1c1c', borderRadius: '6px', padding: '9px 12px', color: '#c4c4c4', fontSize: '13px', lineHeight: '1.6', resize: 'none', fontFamily: sans }}
        />
        <button className="run-btn" style={{ background: '#1d4ed8', border: 'none', borderRadius: '6px', padding: '9px 15px', color: '#fff', fontSize: '12.5px', fontWeight: 600, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '7px', flexShrink: 0, marginTop: '1px', transition: 'background 0.15s' }}>
          <span style={{ fontSize: '10px' }}>▶</span> Run Test
        </button>
      </div>

      {/* Main area */}
      <div ref={containerRef} style={{ flex: 1, display: 'flex', flexDirection: 'column', overflow: 'hidden' }}>

        {/* Top: response panels */}
        <div ref={topRef} style={{ height: `${hSplit}%`, display: 'flex', overflow: 'hidden' }}>

          {/* With skill */}
          <div style={{ width: `${vSplit}%`, display: 'flex', flexDirection: 'column', borderRight: border, overflow: 'hidden' }}>
            <div style={{ padding: '6px 16px', borderBottom: border, display: 'flex', alignItems: 'center', gap: '8px', flexShrink: 0, background: '#080808' }}>
              <span style={labelStyle}>Agent Plan</span>
              <span style={{ fontSize: '10px', background: '#052e16', color: '#4ade80', padding: '2px 7px', borderRadius: '4px', fontWeight: 500 }}>with skill</span>
            </div>
            <PlanPanel lines={WITH_PLAN} />
          </div>

          {/* Vertical divider */}
          <div
            onMouseDown={(e) => { vDragging.current = true; e.preventDefault(); }}
            style={{ width: '4px', flexShrink: 0, background: '#0e0e0e', borderLeft: border, borderRight: border, cursor: 'col-resize', transition: 'background 0.15s' }}
            onMouseEnter={e => e.currentTarget.style.background = '#1d4ed8'}
            onMouseLeave={e => e.currentTarget.style.background = '#0e0e0e'}
          />

          {/* Without skill */}
          <div style={{ flex: 1, display: 'flex', flexDirection: 'column', overflow: 'hidden' }}>
            <div style={{ padding: '6px 16px', borderBottom: border, display: 'flex', alignItems: 'center', gap: '8px', flexShrink: 0, background: '#080808' }}>
              <span style={labelStyle}>Agent Plan</span>
              <span style={{ fontSize: '10px', background: '#1c1008', color: '#fb923c', padding: '2px 7px', borderRadius: '4px', fontWeight: 500 }}>no skill</span>
            </div>
            <PlanPanel lines={WITHOUT_PLAN} />
          </div>
        </div>

        {/* Horizontal divider */}
        <div
          onMouseDown={(e) => { hDragging.current = true; e.preventDefault(); }}
          style={{ height: '4px', flexShrink: 0, background: '#0e0e0e', borderTop: border, borderBottom: border, cursor: 'row-resize', transition: 'background 0.15s' }}
          onMouseEnter={e => e.currentTarget.style.background = '#1d4ed8'}
          onMouseLeave={e => e.currentTarget.style.background = '#0e0e0e'}
        />

        {/* Bottom: evaluator */}
        <div style={{ flex: 1, display: 'flex', flexDirection: 'column', overflow: 'hidden', minHeight: 0 }}>
          <div style={{ padding: '6px 16px', borderBottom: border, display: 'flex', alignItems: 'center', gap: '10px', flexShrink: 0, background: '#080808' }}>
            <span style={labelStyle}>Evaluator</span>
          </div>
          <div style={{ flex: 1, overflow: 'auto', padding: '10px 16px' }}>
            {EVAL_BULLETS.map((b, i) => (
              <div key={i} className="fade-in" style={{ display: 'flex', gap: '10px', alignItems: 'flex-start', padding: '6px 0', borderBottom: i < EVAL_BULLETS.length - 1 ? '1px solid #111' : 'none', animationDelay: `${i * 0.07}s`, opacity: 0 }}>
                <span style={{ fontSize: '11px', flexShrink: 0, marginTop: '1px', color: b.type === 'pos' ? '#4ade80' : '#f87171' }}>
                  {b.type === 'pos' ? '↑' : '↓'}
                </span>
                <span style={{ fontFamily: sans, fontSize: '12.5px', lineHeight: '1.55', color: b.type === 'pos' ? '#9a9a9a' : '#7a7a7a' }}>
                  {b.text}
                </span>
              </div>
            ))}
          </div>
        </div>
      </div>

      {/* Status bar */}
      <div style={{ height: '22px', background: '#060606', borderTop: border, display: 'flex', alignItems: 'center', padding: '0 16px', gap: '10px', flexShrink: 0 }}>
        <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>
          <div style={{ width: '5px', height: '5px', borderRadius: '50%', background: '#16a34a' }} />
          <span style={{ fontSize: '10.5px', color: '#383838' }}>completed</span>
        </div>
        <span style={{ color: '#1e1e1e' }}>·</span>
        <span style={{ fontSize: '10.5px', color: '#383838' }}>dbt-fabric-skill</span>
        <span style={{ color: '#1e1e1e' }}>·</span>
        <span style={{ fontSize: '10.5px', color: '#383838' }}>plan mode</span>
        <span style={{ color: '#1e1e1e' }}>·</span>
        <span style={{ fontSize: '10.5px', color: '#383838' }}>2.3s</span>
        <div style={{ flex: 1 }} />
        <span style={{ fontSize: '10.5px', color: '#272727' }}>no context · fresh run</span>
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App />);
</script>
</body>
</html>
